#!/bin/bash

# Docker é•œåƒåŠ é€Ÿå™¨æµ‹è¯•ç½‘ç«™å¯åŠ¨è„šæœ¬

echo "ğŸ³ Docker é•œåƒåŠ é€Ÿå™¨æµ‹è¯•ç½‘ç«™"
echo "================================"
echo ""

# æ£€æŸ¥ Docker æ˜¯å¦å®‰è£…
if ! command -v docker &> /dev/null; then
    echo "âŒ é”™è¯¯: æœªå®‰è£… Docker"
    echo "è¯·å…ˆå®‰è£… Docker: https://docs.docker.com/get-docker/"
    exit 1
fi

# æ£€æŸ¥ Docker Compose æ˜¯å¦å®‰è£…
if ! command -v docker-compose &> /dev/null && ! docker compose version &> /dev/null; then
    echo "âŒ é”™è¯¯: æœªå®‰è£… Docker Compose"
    echo "è¯·å…ˆå®‰è£… Docker Compose"
    exit 1
fi

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
if lsof -Pi :5000 -sTCP:LISTEN -t >/dev/null 2>&1 ; then
    echo "âš ï¸  è­¦å‘Š: ç«¯å£ 5000 å·²è¢«å ç”¨"
    echo "è¯·åœæ­¢å ç”¨ç«¯å£çš„æœåŠ¡æˆ–ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£é…ç½®"
    read -p "æ˜¯å¦ç»§ç»­? (y/n) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

echo "ğŸ“¦ æ„å»º Docker é•œåƒ..."
docker-compose build

echo ""
echo "ğŸš€ å¯åŠ¨æœåŠ¡..."
docker-compose up -d

echo ""
echo "âœ… æœåŠ¡å·²å¯åŠ¨ï¼"
echo ""
echo "ğŸŒ è®¿é—®åœ°å€: http://localhost:5000"
echo ""
echo "ğŸ“‹ å¸¸ç”¨å‘½ä»¤:"
echo "  æŸ¥çœ‹æ—¥å¿—: docker-compose logs -f"
echo "  åœæ­¢æœåŠ¡: docker-compose down"
echo "  é‡å¯æœåŠ¡: docker-compose restart"
echo ""

